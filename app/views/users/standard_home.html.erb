<h1>Welcome to your home page</h1>

<p>Your email address is: <%= current_user.email %></p>

<button onclick="toggleForm()">Create delivery</button>

<div id="form-container" style="display:none">
  <%= form_tag("/deliveries", method: "post") do %>
      <%= hidden_field_tag :customer_id, current_user.id %>
      <%= label_tag "Street" %>
      <%= text_field_tag "delivery[street]" %>
      <br>
      <%= label_tag "House number" %>
      <%= text_field_tag "delivery[house_number]" %>
      <br>
      <%= label_tag "Height" %>
      <%= text_field_tag "delivery[height]" %>
      <br>
      <%= label_tag "Width" %>
      <%= text_field_tag "delivery[width]" %>
      <br>
      <%= label_tag "Depth" %>
      <%= text_field_tag "delivery[depth]" %>
      <br>
      <%= label_tag "Payment" %>
      <div id="stripe-container"></div>
      <br>
      <%= submit_tag "Submit" %>
  <% end %>
</div>

<script src="https://js.stripe.com/v3/"></script>
<script>
    var stripe = Stripe('pk_test_51MQSDuEM03nHu9w8mCc2cFV1HwsrtgsHDAnE0mQCJubYxjCoqUDNZVQ4qarwOuhii0p2PdkosflO2q7fNK5WoUM500MxAsTXhi');
    var elements = stripe.elements();
    var style = {
      base: {
        color: '#32325d',
        fontFamily: '"Helvetica Neue", Helvetica, sans-serif',
        fontSmoothing: 'antialiased',
        fontSize: '16px',
        '::placeholder': {
          color: '#aab7c4'
        }
      },
      invalid: {
        color: '#fa755a',
        iconColor: '#fa755a'
      }
    };
    var card = elements.create('card', {style: style});
    card.mount('#stripe-container');

    // handle form submission
    var form = document.querySelector("form");
    form.addEventListener("submit", async function(event) {
        event.preventDefault();
        stripe.createToken(card).then(function(result) {
            if (result.error) {
                // Inform the customer that there was an error
                var errorElement = document.getElementById('card-errors');
                errorElement.textContent = result.error.message;
            } else {
                // Send the token to your server
                stripeTokenHandler(result.token);
             }
        });
    });
</script>

<h2>Orders</h2>
<% @user_deliveries.each do |order| %>
  <p>
    Street: <%= order.street %> <br>
    House number: <%= order.house_number %> <br>
    Dimensions: <%= order.height %> x <%= order.width %> x <%= order.depth %> <br>
    Status: <%= order.status %> <br>
    Tracking Number: <%= order.tracking_number %>
  </p>
<% end %>

<% if user_signed_in? %>
  <%= link_to "Log out", destroy_user_session_path, method: :delete %>
<% end %>
